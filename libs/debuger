#!/bin/bash
#----------------------------------------------------------------------------------
#
#   Проект: Молот [molot]
# 
#   Файл предназначен для отладки скриптов сборки под Entware
#   Запускается ВНУТРИ контейнера при его запуске
# 
#   Подключается в виде библиотеки в файле container
# 
#   Автор       : Железа
#   Email       : dev@zeleza.ru
#   Лицензия    : Apache Версия 2.0
#
#   Создан      : 27 октября 2024 год
#   Обновлен    : 30 октября 2024 год
# 
#----------------------------------------------------------------------------------

# Массив функций стадий
STAGES_FUNC_NAME=(
	stage1
	stage2
	stage3
	stage4
	stage5
	stage6
	stage7
	stage8
)


stage1(){
	message "[#1] Клонирование репозитория entware..."
	
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#1]: Возникла ошибка при клонировании репозитория Entware"
		return 1
	}
	echo 1 > "${BUILDED_STAGES_FILE}"
	return 0
}
stage2(){
	message "[#2] Обновление символических ссылок..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#2]: Возникла ошибка при обновлении символических ссылок"
		return 1
	}
	echo 2 > "${BUILDED_STAGES_FILE}"
	return 0
}

stage3(){
	message "[#3] Подготовка конфигурации для конкретной архитектуры..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#3]: Возникла ошибка при подготовке конфигурации"
		return 1
	}
	echo 3 > "${BUILDED_STAGES_FILE}"
	return 0
}

stage4(){
	message "[#4] Сборка toolchain..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#4]: Возникла ошибка при сборке toolchain"
		return 1
	}
	echo 4 > "${BUILDED_STAGES_FILE}"
	return 0
}

stage5(){
	
	message "[#5] Сборка пакета ${APP_NAME}..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#5]: Возникла ошибка при сборке пакета ${APP_NAME}"
		return 1
	}
	echo 5 > "${BUILDED_STAGES_FILE}"
	return 0
}

stage6(){
	message "[#6] Копирование пакета ${APP_NAME} в директорию проекта..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#6]: Возникла ошибка при копировании пакета ${APP_NAME} в директорию проекта"
		return 1
	}
	echo 6 > "${BUILDED_STAGES_FILE}"
	return 0
}

stage7(){
	message "[#7] Копирование пакета ${APP_NAME} на роутер..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#7]: Возникла ошибка при копировании пакета ${APP_NAME} на роутер"
		return 1
	}
	echo 7 > "${BUILDED_STAGES_FILE}"
	return 0
}

stage8(){
	message "[#8] Установка и запуск пакета ${APP_NAME} на роутере..."
	# Генерация случайного числа 0 или 1, 
	# для случайного возникновения ошибки
	[ $((RANDOM % 2)) -eq 1 ] && {
		error "[#8]: Возникла ошибка при установке и запуске пакета ${APP_NAME} на роутере"
		return 1
	}
	echo 8 > "${BUILDED_STAGES_FILE}"
	return 0
}

